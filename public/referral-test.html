<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Referral Capture Test - ShareWizard</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        .test-link {
            display: inline-block;
            margin: 10px;
            padding: 10px 20px;
            background: #3b82f6;
            color: white;
            text-decoration: none;
            border-radius: 5px;
            transition: background-color 0.2s;
        }
        .test-link:hover {
            background: #2563eb;
        }
        .test-section {
            margin: 30px 0;
            padding: 20px;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
        }
        .warning {
            background: #fef3c7;
            border: 1px solid #f59e0b;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
        }
        .success {
            background: #d1fae5;
            border: 1px solid #10b981;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
        }
        code {
            background: #f3f4f6;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'SF Mono', Monaco, 'Cascadia Code', monospace;
        }
    </style>
</head>
<body>
    <h1>üß™ Referral Capture Test Suite</h1>
    
    <div class="success">
        <strong>‚úÖ Implementation Complete!</strong><br>
        The referral capture system is now fully integrated into ShareWizard.
        <br><br>
        <strong>üß™ Mock Data Enabled:</strong> Development mode is using test partner data for codes:
        <code>ACME2024</code>, <code>PARTNER123</code>, and <code>TESTCODE</code>
    </div>

    <div class="warning">
        <strong>‚ÑπÔ∏è Development Mode:</strong><br>
        Mock partner data is enabled via <code>VITE_USE_MOCK_PARTNERS=true</code> in .env.local.
        The test codes below will now work and show success toasts with partner information.
        <br><br>
        In production, these would validate against real Firestore partner data.
    </div>

    <div class="test-section">
        <h2>üîó Basic Referral Code Tests</h2>
        <p>Click these links to test referral code capture:</p>
        
        <a href="http://localhost:8081/en/home?ref=ACME2024" class="test-link">
            Test ACME2024 (Example Code)
        </a>
        
        <a href="http://localhost:8081/en/home?ref=PARTNER123" class="test-link">
            Test PARTNER123 (Example Code)
        </a>
        
        <a href="http://localhost:8081/en/home?ref=INVALID" class="test-link">
            Test INVALID (Should Fail)
        </a>
        
        <a href="http://localhost:8081/fr/home?ref=TESTCODE" class="test-link">
            Test French (FR)
        </a>
    </div>

    <div class="test-section">
        <h2>üåê Multi-Language Tests</h2>
        <p>Test referral capture across different language routes:</p>
        
        <a href="http://localhost:8081/en/pricing?ref=PRICING123" class="test-link">
            English Pricing Page
        </a>
        
        <a href="http://localhost:8081/fr/pricing?ref=PRIX123" class="test-link">
            French Pricing Page
        </a>
        
        <a href="http://localhost:8081/en/signup?ref=SIGNUP2024" class="test-link">
            English Signup Page
        </a>
        
        <a href="http://localhost:8081/fr/signup?ref=INSCRIPTION" class="test-link">
            French Signup Page
        </a>
    </div>

    <div class="test-section">
        <h2>üîÑ Persistence Tests</h2>
        <p>Test referral code persistence across sessions:</p>
        
        <ol>
            <li>Click a referral link above</li>
            <li>Navigate to <a href="http://localhost:8081/en/dashboard" class="test-link">Dashboard</a></li>
            <li>Check if debug panel still shows referral</li>
            <li>Refresh the page - referral should persist</li>
            <li>Open new tab to <a href="http://localhost:8081/en/home" class="test-link">Home (No Ref)</a></li>
            <li>Referral should still be active in new tab</li>
        </ol>
    </div>

    <div class="test-section">
        <h2>üìä Expected Behavior</h2>
        
        <h3>‚úÖ Valid Referral Code</h3>
        <ul>
            <li>Green toast notification appears</li>
            <li>Message: "You're signing up with Partner: [Partner Name]"</li>
            <li>Debug panel (bottom right) shows referral details</li>
            <li>Referral persists across page navigation</li>
            <li>Stored in localStorage and cookies for 90 days</li>
        </ul>

        <h3>‚ùå Invalid Referral Code</h3>
        <ul>
            <li>Red toast notification appears</li>
            <li>Message: "Invalid referral code: [CODE]"</li>
            <li>Debug panel shows "No Active Referral"</li>
            <li>No data stored in browser</li>
        </ul>

        <h3>üîÑ URL Parameter Precedence</h3>
        <ul>
            <li>URL ?ref= parameter always takes precedence</li>
            <li>If no URL param, checks cookies then localStorage</li>
            <li>New URL referral overwrites existing cached referral</li>
        </ul>
    </div>

    <div class="test-section">
        <h2>üõ†Ô∏è Developer Tools</h2>
        <p>Use browser dev tools to inspect the implementation:</p>
        
        <h3>Console Logs</h3>
        <ul>
            <li><code>‚úÖ Referral captured successfully</code> - Successful capture</li>
            <li><code>‚ùå Invalid referral code</code> - Failed validation</li>
            <li><code>üç™ Found valid referral code in cookies</code> - Cache hit</li>
            <li><code>üìù Found referral code in URL</code> - URL parameter detected</li>
        </ul>

        <h3>localStorage Keys</h3>
        <ul>
            <li><code>sharewizard_referral_code</code> - The referral code</li>
            <li><code>sharewizard_partner_info</code> - Partner details JSON</li>
            <li><code>sharewizard_referral_timestamp</code> - Capture timestamp</li>
        </ul>

        <h3>Cookies</h3>
        <ul>
            <li>Same keys as localStorage</li>
            <li>90-day expiration</li>
            <li>SameSite=Lax for security</li>
        </ul>
    </div>

    <div class="test-section">
        <h2>üöÄ Production Setup</h2>
        <p>To use this system in production:</p>
        
        <ol>
            <li><strong>Create Real Partners:</strong> Use the <code>createPartner</code> Cloud Function to create actual partner accounts</li>
            <li><strong>Generate Partner Codes:</strong> Use the <code>createPartnerCode</code> Cloud Function to create referral codes</li>
            <li><strong>Remove Debug Component:</strong> Remove <code>&lt;ReferralStatusDisplay /&gt;</code> from RouterConfig.tsx</li>
            <li><strong>Update Test URLs:</strong> Replace localhost with your production domain</li>
            <li><strong>Monitor Console:</strong> Watch for referral capture logs in production</li>
        </ol>
    </div>

    <script>
        // Simple JavaScript to enhance the demo
        document.addEventListener('DOMContentLoaded', function() {
            // Add click tracking to test links
            const testLinks = document.querySelectorAll('.test-link');
            testLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    const url = this.href;
                    const code = new URLSearchParams(new URL(url).search).get('ref');
                    if (code) {
                        console.log(`üß™ Testing referral code: ${code}`);
                        console.log(`üîó URL: ${url}`);
                    }
                });
            });

            // Check if we're already in the app
            if (window.location.port === '8081') {
                const banner = document.createElement('div');
                banner.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    right: 0;
                    background: #10b981;
                    color: white;
                    padding: 10px;
                    text-align: center;
                    z-index: 9999;
                    font-weight: bold;
                `;
                banner.innerHTML = '‚úÖ You are in the ShareWizard app - referral capture is active!';
                document.body.appendChild(banner);
                document.body.style.paddingTop = '50px';
            }
        });
    </script>
</body>
</html>
